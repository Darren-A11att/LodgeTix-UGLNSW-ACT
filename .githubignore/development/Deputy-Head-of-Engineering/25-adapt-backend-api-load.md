**Title:** Adapt Backend API/Functions for Loading Registration Data\n\n**Description:** Modify the backend API endpoint(s) responsible for fetching data needed to populate the registration form, transforming the normalized database data into the structure expected by the frontend context.\n\n**Instructions:**\n\n1.  **Identify Backend Code:** Locate the server-side code (e.g., Supabase Edge Function, Next.js API route) that handles GET requests for user profile data, event details, or existing registration data.\n2.  **Loading User/Profile Data (for pre-population):**\n    *   When fetching data for a logged-in user:\n        *   Query `public.Contacts` based on `auth.users.id`.\n        *   If found, query `public.MasonicProfiles` using the `contactId`.\n        *   Fetch relevant `OrganisationMemberships`.\n        *   Structure the response payload to contain this profile information clearly separated (e.g., `{ contact: {...}, masonicProfile: {...}, memberships: [...] }`).\n3.  **Loading Event/Registration Data (for editing or viewing):**\n    *   Query `public.Registrations` by `registrationId`.\n    *   Fetch the linked `public.Customers` record.\n    *   Fetch the linked `public.Events` record.\n    *   Fetch all `public.Attendees` records where `registrationId` matches.\n    *   For each `Attendee` record, fetch its linked `public.Contacts` record.\n    *   If an `Attendee` has `attendeeType = \'Mason\'`, also fetch their linked `public.MasonicProfiles` record.\n    *   Fetch all `public.Tickets` records linked to the fetched `Attendees`.\n4.  **Data Transformation Logic:**\n    *   Take the list of fetched `Attendees` (each joined with their `Contacts` and potentially `MasonicProfiles` data).\n    *   Iterate through this list and build the separate arrays expected by the frontend:\n        *   `masons: MasonData[]`\n        *   `guests: GuestData[]`\n        *   `ladyPartners: LadyPartnerData[]`\n        *   `guestPartners: GuestPartnerData[]`\n    *   Map the database fields to the frontend types defined in `src/shared/types/register.ts`.\n    *   Crucially, ensure the `id` field in the frontend types is populated with the `Attendees.attendeeId`.\n    *   For partners, populate `masonId` or `guestId` by finding the corresponding related `Attendees` record's `attendeeId` from the fetched list based on the `relatedAttendeeId` link.\n    *   Reconstruct the `attendeeAddOrder` array based on the fetched attendees and their relationships (this might require sorting or specific logic to match the original visual order if that exact order needs to be preserved on load).\n    *   Structure the response payload containing the event data, registration data, customer data, and the transformed attendee arrays.\n5.  **Tech:** Use Supabase client library (e.g., `.select(\`*, Contacts (*), MasonicProfiles (*)\`)`) or an ORM to perform the necessary joins and data fetching efficiently.\n 